(()=>{"use strict";const e=(e,t)=>new IntersectionObserver((t=>e(t)),t),t=e=>{const t=document.createElement("img"),n=document.createElement("div");return t.style.width="400px",t.style.height="300px",t.setAttribute("data-src",e),t.className="image",n.appendChild(t),n},n=e=>{document.querySelector(".scroll__sensor").classList.remove("show");const t=document.createElement("div"),n=document.createElement("h1"),a=document.createElement("h6");return t.className="error__container",n.className="error__header",n.textContent="Nope.",a.className="error__message",a.textContent=e.message,t.appendChild(n),t.appendChild(a),t};let a=["star_wars"],r=1;const o="https://nv90-server.herokuapp.com/";console.log(`Welcome to nv90. You are running in production mode. Server url is ${o}`);const s=e=>{a.splice(e,1),h()},c=e=>{const t=e.replace(" ","_").toLowerCase();null!==t&&0!==t.length&&(a.includes(t)||(a.push(t),h()))},l=()=>{localStorage.clear(),h()},i=e((e=>{e.forEach((e=>{e.target.classList.toggle("show",e.isIntersecting),e.isIntersecting&&(e.target.src=e.target.getAttribute("data-src"),e.target.style.width="100%",i.unobserve(e.target))}))}),{threshold:.2,rootMargin:"100px"}),d=e((e=>{e.forEach((e=>{e.target.classList.toggle("show",e.isIntersecting),e.isIntersecting&&(r++,d.unobserve(e.target),setTimeout((()=>{u()}),600))}))}),{rootMargin:"100px"}),u=async()=>{const e=`${a.join(",")}_${r}`;let t=[];if(localStorage.getItem(e))t=localStorage.getItem(e).split(",");else{try{if(t=await g(),!t||!t.length>0)return void p({message:"No results. Try another tag."})}catch(e){return void p(e)}localStorage.setItem(e,t.join(","))}m(t)},m=e=>{const n=document.querySelector(".gallery__image__container");document.querySelector(".scroll__sensor").classList.toggle("show"),e.forEach((e=>{n.appendChild(t(e))})),(()=>{const e=document.querySelectorAll(".image"),t=document.querySelector(".scroll__sensor");e.forEach((e=>{i.observe(e)})),d.observe(t)})()},g=async()=>await fetch(`${o}${a.length>0?encodeURI(a.join(",")):"*"}&${r}`).then((e=>e.status>299||e.status<200?e.json().then((t=>{throw new Error(`Error with code: ${e.status}. \n MSG: ${t.message} `)})):e.json())).catch((e=>{throw new Error(e.message)})),_=()=>{const e=document.querySelector(".search__tags__container");e.innerHTML="",a.forEach(((t,n)=>{const a=((e,t,n)=>{const a=document.createElement("button"),r=document.createElement("i"),o=document.createElement("p");return r.className="bi bi-x",a.className="button__basic base__tag search__tag",o.textContent+=e.replace("_"," "),a.appendChild(o),a.appendChild(r),a.addEventListener("click",(()=>{a.style.display="none",n(t)})),a})(t,n,s);e.appendChild(a)}));const t=(e=>{const t=document.createElement("div"),n=document.createElement("i"),a=document.createElement("input");return a.type="text",a.placeholder="Add tag..",a.className="add__new__tag__input",n.className="bi bi-tag",t.className="button__basic base__tag add__new__tag",t.appendChild(n),t.appendChild(a),a.addEventListener("blur",(t=>t.target.value.length>0&&e(t.target.value))),a.addEventListener("keyup",(t=>{"Enter"===t.key&&t.target.value.length>0&&e(t.target.value)})),t})(c),n=(e=>{const t=document.createElement("div"),n=document.createElement("i"),a=document.createTextNode("Clear Cache");return n.className="bi bi-x",t.className="button__basic base__tag add__new__tag clear__cache__tag",t.appendChild(n),t.appendChild(a),t.addEventListener("click",(()=>{e()})),t})(l);e.appendChild(t),e.appendChild(n)},h=()=>{document.querySelector(".gallery__image__container").innerHTML="",r=1,u(),_()},p=e=>{const t=document.querySelector(".gallery__image__container");t.innerHTML="";const a=n(e);t.appendChild(a)};document.addEventListener("load",(r=1,window.onbeforeunload=function(){window.scrollTo(0,0)},u(),void _()))})();